<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="reference _Skins_HTML5_topnav_IBMOEM" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Maintenance">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Data Disk Expansion</title>
        <link rel="icon" href="../../Resources/images/IBM-icon-48.ico" />
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.remove-highlight-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/highlight.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/stylesheets/styles_topnavi.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div>
                        <nav class="title-bar tab-bar" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="relative clearfix"><a class="logo" href="../about/about_application_overview.htm" alt="Logo"></a>
                                    <div class="navigation-wrapper nocontent">
                                        <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="4" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                            <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="nav-search row outer-row">
                                <form class="search" action="#">
                                    <div class="search-bar search-bar-container needs-pie">
                                        <input class="search-field needs-pie" type="search" placeholder="Search the help system" />
                                        <div class="search-filter-wrapper">
                                            <div class="search-filter">
                                                <div class="search-filter-content">
                                                    <ul>
                                                        <li>All Files</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="search-submit-wrapper" dir="ltr">
                                            <div class="search-submit" title="Search">
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row" data-mc-content-body="True">
                            <div class="buttons popup-container clearfix topicToolbarProxy mc-component nocontent" style="margin-left: 0px; float: right; mc-topic-toolbar-items: RemoveHighlight ExpandAll CollapseAll Print;">
                                <div class="button-group-container-left">
                                    <button class="button needs-pie remove-highlight-button" title="Remove Highlights">
                                        <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="remove highlight" />
                                    </button>
                                    <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                        <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                    </button>
                                    <button class="button needs-pie print-button" title="Print">
                                        <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                    </button>
                                </div>
                            </div>
                            <div class="nocontent">
                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                </div>
                            </div>
                            <h1>Data Disk Expansion</h1>
                            <p>This document describes how to add new  virtual disks (hard disks) on your <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> virtual machine through vCenter. By default, when you deploy the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> virtual appliance you have the option to deploy all virtual disks to one datastore that you specify at the time of deployment. These instructions will guide you through adding a new disk within the virtual machine and to configure it as an LVM. You can then mount it as a new volume or attach this new disk to the existing  volumes within the virtual appliance. </p>
                            <p>In order to run the commands below you need to SSH into the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> appliance’s command prompt as <b>serveradmin</b>. The default initial password is “sppDP758-SysXyz” and you will be prompted to change the password at the first login.</p>
                            <p>Review the disk partitions using the <code>fdisk -l</code> command, then review the physical volumes and the volume groups on the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> virtual appliance using the <code>pvdisplay</code> and <code>vgdisplay</code> commands respectively.<br /></p>
                            <p class="ListHeading">Add a disk to the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> virtual machine:</p>
                            <ol>
                                <li value="1">From the vCenter client, edit the settings of the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> virtual machine.</li>
                                <li value="2">On the Hardware tab, click <b>Add...</b></li>
                                <li value="3">Select <b>Create a new virtual disk</b>. </li>
                                <li value="4">Select the required Disk Size. In the Location section, select either:</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span><b>Store with the virtual machine</b> to use the current datastore, or</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span><b>Specify a datastore or datastore cluster</b>, then click <b>Browse...</b> to select the new datstores where you want the virtual disk to reside.</li>
                                <li value="5">Leave the default values in the Advanced Options tab. </li>
                                <li value="6">Review and save your changes. </li>
                                <li value="7">Click the <b>Edit Settings</b> option for the virtual machine to view the new hard disk. </li>
                                <li value="8">Add the new SCSI device without rebooting the virtual machine. This can be performed by going back to the console of the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> virtual machine and running the following command:&#160;<code>echo "- - -" &gt; /sys/class/scsi_host/host&lt;#&gt;/scan</code>, where # is the latest host number. </li>
                            </ol>
                            <p class="ListHeading">Add the storage capacity from the new disk to an existing <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> volume:</p>
                            <p>This section will guide you through adding storage capacity from the new disk to an existing <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> volume. For users that are simply adding an additional volume to their appliance, this section does not need to be completed. First, set up the filesystem for the new disk to be LVM type. </p>
                            <ol>
                                <li value="1">Follow the commands below on the console. The commands set up a partition for the new disk and set the partition to be of type Linux LVM. The output of fdisk  shows you the same.</li>
                            </ol>
                            <p class="Code" style="font-size: 12pt;">[serveradmin@localhost ~]# fdisk /dev/sdd</p>
                            <p class="Code" style="font-size: 12pt;">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</p>
                            <p class="Code" style="font-size: 12pt;">Building a new DOS disklabel with disk identifier 0xb1b293df.</p>
                            <p class="Code" style="font-size: 12pt;">Changes will remain in memory only, until you decide to write them.</p>
                            <p class="Code" style="font-size: 12pt;">After that, of course, the previous content won't be recoverable.</p>
                            <p class="Code" style="font-size: 12pt;">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</p>
                            <p class="Code" style="font-size: 12pt;">WARNING: DOS-compatible mode is deprecated. It's strongly recommended to</p>
                            <p class="Code" style="font-size: 12pt;">switch off the mode (command 'c') and change display units to</p>
                            <p class="Code" style="font-size: 12pt;">sectors (command 'u').</p>
                            <hr width="100%" size="0" align="center" />
                            <p><span class="Code" style="font-size: 12pt;">Command (m for help): <b>n</b></span> (add a new partition)</p>
                            <p class="Code" style="font-size: 12pt;">Command action</p>
                            <p class="Code" style="font-size: 12pt;">e   extended</p>
                            <p class="Code" style="font-size: 12pt;">p   primary partition (1-4)</p>
                            <hr width="100%" size="0" align="center" />
                            <p><span class="Code" style="font-weight: bold;">p</span>	[Selects the primary partition]</p>
                            <hr width="100%" size="0" align="center" />
                            <p class="Code">Partition number (1-4): <b>1</b></p>
                            <hr width="100%" size="0" align="center" />
                            <p><span class="Code" style="font-size: 12pt;">First cylinder (1-2610, default 1):</span><![CDATA[	]]><b>(Leave blank)</b></p>
                            <p class="Code"><span style="font-size: 12pt;">Using default value 1</span>
                            </p>
                            <hr width="100%" size="0" align="center" />
                            <p><span class="Code" style="font-size: 12pt;">Last cylinder, +cylinders or +size{K,M,G} (1-2610, default 2610):</span><![CDATA[	]]><b>(Leave blank)</b></p>
                            <p class="Code"><span style="font-size: 12pt;">Using default value 2610</span>
                            </p>
                            <hr width="100%" size="0" align="center" />
                            <p><span class="Code" style="font-size: 12pt;">Command (m for help):</span> <b>t</b> (change a partition's system id)</p>
                            <p class="Code" style="font-size: 12pt;">Selected partition 1</p>
                            <hr width="100%" size="0" align="center" />
                            <p class="Code" style="font-size: 12pt;">Hex code (type L to list codes): <b>8e</b></p>
                            <p class="Code" style="font-size: 12pt;">Changed system type of partition 1 to 8e (Linux LVM)</p>
                            <hr width="100%" size="0" align="center" />
                            <p><span class="Code" style="font-size: 12pt;">Command (m for help): <b>w</b></span> (write table to disk and exit)</p>
                            <p class="Code" style="font-size: 12pt;">The partition table has been altered!</p>
                            <hr width="100%" size="0" align="center" />
                            <p class="Code" style="font-size: 12pt;">Calling ioctl() to re-read partition table.</p>
                            <p class="Code" style="font-size: 12pt;">Syncing disks.</p>
                            <ol start="2">
                                <li value="2">Review the changes to the disk through the <code>fdisk -1</code> command.</li>
                                <li value="3">Review the current list of Physical Volumes (PV) through the <code>pvdisplay </code>command. </li>
                                <li value="4">Create a new Physical Volume (PV) through the following command:&#160;<code>pvcreate /dev/sdd1</code></li>
                                <li value="5">You can view the newly created PV from /dev/sdd1 through the <code>pvdisplay</code> command. </li>
                                <li value="6">Review the Volume Group (VG) through the <code>vgdisplay</code> command. </li>
                                <li value="7">Add the new Physical Volume (PV) to the Volume Group (VG) to increase the space of the Volume Group (VG)&#160;through the following command:&#160;<code>vgextend data_vg /dev/sdd1</code></li>
                                <li value="8">Through the <code>vgdisplay</code> command, you can see that after the Volume Group (VG) data_vg is extended, there is now free space available for logical volumes (or /data volume) to use.</li>
                                <li value="9">Review the Logical Volume (LV)&#160;/data directory through the <code>lvdisplay </code>command. The usage of the /data volume displays. </li>
                                <li value="10">Add space to the Logical Volume (LV) /data directory through the <code>lvextend </code>command by adding the additional space to the total volume capacity.  In this example  20 GB of space is being added to a 100 GB  volume:</li>
                            </ol>
                            <p class="Code" style="font-size: 12pt;">[serveradmin@localhost ~]# lvextend -L120gb -r /dev/data_vg/data</p>
                            <p class="Code" style="font-size: 12pt;">Size of logical volume data_vg/data changed from 100.00 GiB  to 120.00 GiB.</p>
                            <p class="Code" style="font-size: 12pt;">Logical volume data successfully resized</p>
                            <p class="Code" style="font-size: 12pt;">resize2fs 1.41.12 (date)</p>
                            <p class="Code" style="font-size: 12pt;">Filesystem at /dev/mapper/data_vg-data is mounted on /data; on-line resizing required</p>
                            <p class="Code" style="font-size: 12pt;">old desc_blocks = 7, new_desc_blocks = 8</p>
                            <p class="Code" style="font-size: 12pt;">Performing an on-line resize of /dev/mapper/data_vg-data to 31195136 (4k) blocks.</p>
                            <p class="Code" style="font-size: 12pt;">The filesystem on /dev/mapper/data_vg-data is now 31195136 blocks long.</p>
                            <ol start="11">
                                <li value="11">After running the above, the size of the /data volume displays as the following:</li>
                            </ol>
                            <p class="Code" style="font-size: 12pt;">[serveradmin@localhost ~]# lvdisplay</p>
                            <p class="Code" style="font-size: 12pt;">--- Logical volume ---</p>
                            <p class="Code" style="font-size: 12pt;">LV Path:                /dev/data_vg/data</p>
                            <p class="Code" style="font-size: 12pt;">LV Name:                data</p>
                            <p class="Code" style="font-size: 12pt;">VG Name:                data_vg</p>
                            <p class="Code" style="font-size: 12pt;">LV UUID:&#160;[uuid]             </p>
                            <p class="Code" style="font-size: 12pt;">LV Write Access:        read/write</p>
                            <p class="Code" style="font-size: 12pt;">LV Creation host, time localhost.localdomain, [date, time]</p>
                            <p class="Code" style="font-size: 12pt;">LV Status:              available</p>
                            <p class="Code" style="font-size: 12pt;"># open:                 1</p>
                            <p class="Code" style="font-size: 12pt;">LV Size:                120.00 GiB</p>
                            <p class="Code" style="font-size: 12pt;">Current LE:             30208</p>
                            <p class="Code" style="font-size: 12pt;">Segments             :  2</p>
                            <p class="Code" style="font-size: 12pt;">Allocation             inherit</p>
                            <p class="Code" style="font-size: 12pt;">Read ahead sectors:     auto</p>
                            <p class="Code" style="font-size: 12pt;">- currently set to:     256</p>
                            <p class="Code" style="font-size: 12pt;">Block device:           253:1</p>
                            <hr width="100%" size="0" align="center" />
                            <p class="Code" style="font-size: 12pt;">[serveradmin@localhost ~]# df -h</p>
                            <p class="Code" style="font-size: 12pt;">Filesystem            Size  Used Avail Use% Mounted on</p>
                            <p class="Code" style="font-size: 12pt;">/dev/sda3              14G  2.6G   11G  20% /</p>
                            <p class="Code" style="font-size: 12pt;">tmpfs                  16G     0   16G   0% /dev/shm</p>
                            <p class="Code" style="font-size: 12pt;">/dev/sda1             240M   40M  188M  18% /boot</p>
                            <p class="Code" style="font-size: 12pt;">/dev/mapper/data_vg-data</p>
                            <p class="Code" style="font-size: 12pt;">118G  6.4G  104G   6% /data</p>
                            <p class="Code" style="font-size: 12pt;">/dev/mapper/data2_vg-data2</p>
                            <p class="Code" style="font-size: 12pt;">246G  428M  234G   1% /data2</p>
                            <p>The data disks have quotas in place to ensure disks are not filled to capacity. When a data disk is expanded, set a new disk quota hard limit, which is generally 90% of the total capacity. Through the <span class="Code">edquota –u mongod</span> command, change the values under “blocks hard” to your desired quota.</p>
                            <div class="RelatedTopic">
                                <p class="PostPreRelTitleLeft"><span class="PostPreRelTitle">RELATED TOPICS:</span>
                                </p>
                                <ul>
                                    <li value="1"><a href="maintenance_appliance_log_on.htm" class="MCXref xref" xrefformat="{paratext}">Log On to the Virtual Appliance</a>
                                    </li>
                                    <li value="2"><a href="maintenance_manage_admin_console.htm" class="MCXref xref" xrefformat="{paratext}">Manage the Administrative Console</a>
                                    </li>
                                </ul>
                            </div>
                            <p>&#160;</p>
                            <hr width="100%" size="0" align="center" />
                            <p style="text-align: left;"><span class="Strong" style="font-size: 10pt;">IBM Spectrum Protect Plus</span> <span class="Strong" style="font-size: 10pt;">10.1.2</span> <![CDATA[ ]]></p>
                            <p style="font-size: 8pt;">Licensed Material - Property of IBM Corp. © IBM Corporation and other(s) <span class="GeneralYear">2018</span>. IBM is a registered trademark of the IBM Corporation in the United States, other countries, or both. <span style="font-size: 10pt;"><span style="font-size: 8pt;">| </span></span><span style="font-size: 8pt;" class="SystemShortDate">8/23/2018</span></p>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>