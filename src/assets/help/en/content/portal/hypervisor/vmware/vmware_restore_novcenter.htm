<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="task _Skins_HTML5_topnav_IBMOEM" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Operations|VMware">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Restoring when vCenter or Other Management VMs Are Not Accessible</title>
        <link rel="icon" href="../../../Resources/images/IBM-icon-48.ico" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.remove-highlight-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/highlight.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../resources/stylesheets/styles_topnavi.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div>
                        <nav class="title-bar tab-bar" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="relative clearfix"><a class="logo" href="../../about/about_application_overview.htm" alt="Logo"></a>
                                    <div class="navigation-wrapper nocontent">
                                        <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="4" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                            <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="nav-search row outer-row">
                                <form class="search" action="#">
                                    <div class="search-bar search-bar-container needs-pie">
                                        <input class="search-field needs-pie" type="search" placeholder="Search the help system" />
                                        <div class="search-filter-wrapper">
                                            <div class="search-filter">
                                                <div class="search-filter-content">
                                                    <ul>
                                                        <li>All Files</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="search-submit-wrapper" dir="ltr">
                                            <div class="search-submit" title="Search">
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row" data-mc-content-body="True">
                            <div class="buttons popup-container clearfix topicToolbarProxy mc-component nocontent" style="margin-left: 0px; float: right; mc-topic-toolbar-items: RemoveHighlight ExpandAll CollapseAll Print;">
                                <div class="button-group-container-left">
                                    <button class="button needs-pie remove-highlight-button" title="Remove Highlights">
                                        <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="remove highlight" />
                                    </button>
                                    <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                        <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                    </button>
                                    <button class="button needs-pie print-button" title="Print">
                                        <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                    </button>
                                </div>
                            </div>
                            <div class="nocontent">
                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                </div>
                            </div>
                            <h1>Restoring when vCenter or Other Management VMs Are Not Accessible</h1>
                            <p><span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> provides an option to automatically restore by using ESXi hosts if the vCenter is not accessible. This option restores the vCenter VM or VMs that the vCenter is dependent on.</p>
                            <p>This procedure applies if any of the following management services are partially or fully lost in your environment:
</p>
                            <ul>
                                <li value="1">vCenter</li>
                                <li value="2">Platform Services Controller (PSC)</li>
                                <li value="3">Software-Defined Data Center (SDDC)</li>
                                <li value="4">Active Directory (AD)/Domain Name System (DNS) servers</li>
                            </ul>
                            <p> In order to recover without a vCenter, the ESXi host must have either a standard switch or a preexisting distributed switch with ephemeral binding. In these conditions are not available, a new standard switch should be created on the ESXi host.  If there are no available uplinks for the standard switch, it must be removed from a distributed switch.</p>
                            <p>Additional manual steps are required to complete a restore operation when running on a VCS environment.</p>
                            <p>Recovering a management VMs on a VCS environment could result in the loss of access to VMs. This is caused because of a misconfiguration of the virtual switch. Complete the following steps on the affected VMs to recover from this state and to complete a recovery operation:</p>
                            <ol>
                                <li value="1">Connect to the destination ESXi UI host and create a new standard virtual switch. At the beginning, there are no port groups or uplinks for the switch.</li>
                                <li value="2">Use SSH to connect to the ESXi server. Identify and select the physical NIC and the port group of the existing distributed virtual switch SDDC-Dswitch-Private. This sample used the vnic vmnic0, which is part of the port ID 64. You can list the Distributed Virtual Switch (DVS) information by issuing the following command:</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span><code>#esxcli network vswitch dvs vmware list</code>
                                </li>
                                <li value="3">Based on the previous information, remove the NIC and port ID (port group) from the SDDC-Dswitch-Private DVS. Use the port ID from step 2.</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span><code>#esxcfg-vswitch -Q &lt;physical_vnic&gt; -V &lt;port_group&gt; SDDC-Dswitch-Private</code>
                                </li>
                                <li value="4">Add the NIC and port group into the standard switch created in step 1:</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span><code>#esxcli network vswitch standard uplink add –-uplink-name=&lt;physical_vnic&gt; --vswitch-name=&lt;standard_vswitch&gt;</code>
                                </li>
                                <li value="5">In the ESXi interface, add a port group and select the standard virtual switch.</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span>At this point, the virtual switch should have one uplink and one port group.</li>
                                <li value="6">	Run a restore operation with the <b>ESX host if vCenter is down</b> option enabled in the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> interface.</li>
                                <li value="7">Click <b>Options</b> and make sure you choose the new networking switch that you created in step 1 under <b>Networking</b>.</li>
                                <li value="8">Using the destination ESXI UI, power on the recovered VM.</li>
                                <li value="9">Once the VMs are reachable, log in into the vCenter UI and start the migration of the management VMs from the temporary port group created in step 5 to the original distributed port group, SDDC-DPortGroup-Mgmt.</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span>Start a migration from the Networking tab by selecting a datacenter and then selecting <b>Migrate VMs to Another Network</b> from the <b>Actions</b> menu. Select the source network (the temporary switch created in step 5) and the destination network (management switch).</li>
                                <li value="10">Once all VMs are migrated into the original port group, reincorporate the physical NIC and the port group into the original distributed virtual switch:</li>
                                <ol style="list-style-type: lower-alpha;">
                                    <li value="1">Remove the network cards (known as vmnics) from a standard vSwitch that was re-assigned previously by using the following command:</li>
                                    <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span><code>#esxcli network vswitch standard uplink remove --uplink-name=vmnic --vswitch-name=vSwitch</code>
                                    </li>
                                    <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span>For example:</li>
                                    <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span><code>#esxcli network vswitch standard uplink remove --uplink-name=vmnic0 --vswitch-name=vered_recovery</code>
                                    </li>
                                    <li value="2">Add network cards to a vNetwork Distributed Switch (vDS) by using the following command:</li>
                                    <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span>#esxcfg-vswitch -P vmnic -V unused_dvPort_ID dvSwitch # add a vDS uplink</li>
                                    <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span>For example:</li>
                                    <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span>#esxcfg-vswitch -P vmnic0 -V 64 SDDC-Dswitch-Private</li>
                                </ol>
                                <li value="11">Delete the temporary port group and the standard vSwitch from the ESXi host UI.</li>
                                <li value="12">After the VMs are migrated and accessible, use the ESXI host UI to unregister (do not delete) the old VMs (if the original host is reachable). This avoids having duplicated information such as names, Media Access Control (MAC) addresses, OS level IDs, and VM Universal Unique Identifiers (UUIDs). This step must to be performed even if you are using a new datastore.</li>
                                <li class="indent" data-mc-autonum=""><span class="autonumber"><span></span></span>Note: In some vSphere or ESXi versions, the unregister operation can be performed by using the Remove from inventory option. This unregisters a VM from the vCenter catalog but leaves vmdk files on the datastore consuming storage space. Once you have fully recovered the VM and the environment is successfully running, you can regain the space by manually removing these files from the datastore.</li>
                            </ol>
                            <div class="RelatedTopic">
                                <p class="PostPreRelTitleLeft"><span class="PostPreRelTitle">RELATED TOPICS:</span>
                                </p>
                                <ul>
                                    <li value="1"><a href="vmware_backup.htm" class="MCXref xref" xrefformat="{paratext}">Create a VMware Backup Job Definition</a>
                                    </li>
                                    <li value="2"><a href="vmware_manage.htm" class="MCXref xref" xrefformat="{paratext}">Add a VMware Provider</a>
                                    </li>
                                </ul>
                            </div>
                            <p>&#160;</p>
                            <hr width="100%" size="0" align="center" />
                            <p style="text-align: left;"><span class="Strong" style="font-size: 10pt;">IBM Spectrum Protect Plus</span> <span class="Strong" style="font-size: 10pt;">10.1.2</span> <![CDATA[ ]]></p>
                            <p style="font-size: 8pt;">Licensed Material - Property of IBM Corp. © IBM Corporation and other(s) <span class="GeneralYear">2018</span>. IBM is a registered trademark of the IBM Corporation in the United States, other countries, or both. <span style="font-size: 10pt;"><span style="font-size: 8pt;">| </span></span><span style="font-size: 8pt;" class="SystemShortDate">8/23/2018</span></p>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>