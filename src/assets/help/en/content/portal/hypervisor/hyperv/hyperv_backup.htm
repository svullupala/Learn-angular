<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="task _Skins_HTML5_topnav_IBMOEM" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Operations|Hyper-V">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Create a Hyper-V Backup Job Definition</title>
        <link rel="icon" href="../../../Resources/images/IBM-icon-48.ico" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.remove-highlight-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/highlight.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../resources/stylesheets/styles_topnavi.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div>
                        <nav class="title-bar tab-bar" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="relative clearfix"><a class="logo" href="../../about/about_application_overview.htm" alt="Logo"></a>
                                    <div class="navigation-wrapper nocontent">
                                        <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="4" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                            <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="nav-search row outer-row">
                                <form class="search" action="#">
                                    <div class="search-bar search-bar-container needs-pie">
                                        <input class="search-field needs-pie" type="search" placeholder="Search the help system" />
                                        <div class="search-filter-wrapper">
                                            <div class="search-filter">
                                                <div class="search-filter-content">
                                                    <ul>
                                                        <li>All Files</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="search-submit-wrapper" dir="ltr">
                                            <div class="search-submit" title="Search">
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row" data-mc-content-body="True">
                            <div class="buttons popup-container clearfix topicToolbarProxy mc-component nocontent" style="margin-left: 0px; float: right; mc-topic-toolbar-items: RemoveHighlight ExpandAll CollapseAll Print;">
                                <div class="button-group-container-left">
                                    <button class="button needs-pie remove-highlight-button" title="Remove Highlights">
                                        <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="remove highlight" />
                                    </button>
                                    <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                        <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                    </button>
                                    <button class="button needs-pie print-button" title="Print">
                                        <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                    </button>
                                </div>
                            </div>
                            <div class="nocontent">
                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                </div>
                            </div>
                            <h1>Create a Hyper-V Backup Job Definition</h1>
                            <div class="Prerequisite">
                                <p class="PostPreRelTitleLeft"><span class="PostPreRelTitle"> BEFORE&#160;YOU&#160;BEGIN:</span>
                                </p>
                                <ul>
                                    <li value="1">Register the providers  to back up. See <a href="hyperv_manage.htm" class="MCXref xref" xrefformat="{paratext}">Add a Hyper-V Provider</a>. </li>
                                    <li value="2">Configure an&#160;SLA&#160;Policy.  See <a href="../../sla_policy/sla_policy_create.htm" class="MCXref xref" xrefformat="{paratext}">Configure SLA&#160;Policies</a>.</li>
                                    <li value="3">Hyper-V Backup and Restore jobs require the installation of the latest Hyper-V integration services. For Microsoft Windows environments, see <a href="https://docs.microsoft.com/en-us/windows-server/virtualization/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows" target="_blank">https://docs.microsoft.com/en-us/windows-server/virtualization/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows</a>. For Linux environments, see <a href="https://docs.microsoft.com/en-us/windows-server/virtualization/hyper-v/supported-linux-and-freebsd-virtual-machines-for-hyper-v-on-windows" target="_blank">https://docs.microsoft.com/en-us/windows-server/virtualization/hyper-v/supported-linux-and-freebsd-virtual-machines-for-hyper-v-on-windows</a>.</li>
                                    <li value="4">
                                        <p> All Hyper-V servers, including cluster nodes, must have the Microsoft iSCSI initiator Service running in their Services list. Set the service to Automatic so that it is available when the machine boots.</p>
                                    </li>
                                    <li value="5"> Before an <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> user can perform backup and restore operations, roles and resource groups must be assigned to the user. Grant users access to resources and backup and restore operations through the <b data-mc-conditions="Default.1012 navigation">Accounts</b> pane. See <a href="../../access/access_overview.htm" class="MCXref xref" xrefformat="{paratext}">Access</a>.</li>
                                </ul>
                                <p class="PostPreRelTitleLeft"><span class="PostPreRelTitle"> CONSIDERATIONS:</span>
                                </p>
                                <ul>
                                    <li value="1">If a virtual machine is associated with multiple SLA Policies, ensure that the policies are not scheduled to run concurrently. It is recommended to either schedule the SLA Policies to run with a significant amount of time between them, or combine them into a single SLA Policy.</li>
                                    <li value="2">If the IP&#160;address of the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> appliance is changed after an initial Hyper-V base backup is created, the target IQN&#160;of the Hyper-V resource may experience connectivity issues. To correct this issue, from the Microsoft iSCSI&#160;Initiator tool, click the Discovery tab. Select the old IP&#160;address, then click Remove. Click the Target tab and disconnect the reconnecting session. </li>
                                </ul>
                            </div>
                            <p class="ListHeading">To create a Hyper-V&#160;Backup job definition:</p>
                            <ol>
                                <li value="1" data-mc-conditions="Default.1012 navigation">From the navigation menu, expand <b>Manage Protection</b>, then expand <b>Hypervisors</b>. Expand <b>Hyper-V</b>, then click <b>Backup</b>.</li>
                                <li value="2">Select resources to back up. Use the search function to search for available resources and toggle the displayed resources through the View filter. Available options include <b>VM</b><b>s</b> and <b>Datastore</b>.</li>
                                <li value="3">Click <b>Select SLA&#160;Policy</b> to add an SLA&#160;Policy to the job definition  that meets your backup data criteria. </li>
                                <li value="4">To create the job definition using default options, click <b>Save</b>. The job runs as defined by your SLA&#160;Policy, or can be run manually from the <span class="GeneralJob Monitor">Job Monitor</span> pane. </li>
                                <li value="5">To edit options before creating the job definition, click <b>Select Options</b>. Set the job definition options.</li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Make VM snapshot application/file system consistent </li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Enable to turn on application or file-system consistency for the virtual machine snapshot. </li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Skip Read-only datastores</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Enable to skip datastores mounted as read-only.</li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Skip temporary datastores mounted for Instant Access </li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Enable to exclude temporary Instant Access datastores from the backup job definition. </li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Catalog file metadata</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>To turn on file indexing for the associated snapshot, enable the Catalog file metadata option. Once file indexing completes, individual files can be restored through the File Restore pane in <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span>. Note that credentials must be established for the associated virtual machine  through the Guest OS&#160;Username and Guest OS&#160;Password option  within the backup job definition. Ensure the virtual machine can be accessed from the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> appliance either through DNS or host-name.</li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Truncate SQL&#160;logs</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>To truncate application logs for SQL during the Backup job, enable the Truncate SQL&#160;logs option. Note that credentials must be established for the associated virtual machine  through the Guest OS&#160;Username and Guest OS&#160;Password option  within the backup job definition. The user identity follows the default <b>domain\Name</b> format if the virtual machine is attached to a domain. The format <b>.\&lt;local administrator&gt;</b> is used if the user is a local administrator. </li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>The user identity must have local administrator privileges. Additionally, on the SQL server, the system login credential must have SQL&#160;sysadmin permissions enabled, as well as the "Log on as a service" right, which is assigned through the Administrative Tools control panel on the local machine (Local Security Policy &gt; Local Policies &gt; User Rights Assignment &gt; Log on as a service). For more information about the "Log on as a service" right, see <a href="https://technet.microsoft.com/en-us/library/cc794944.aspx" target="_blank">https://technet.microsoft.com/en-us/library/cc794944.aspx</a>.</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span><span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> generates logs pertaining to the log truncation function and copies them to the following location on the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> appliance: /data/log/guestdeployer/&lt;Latest-Date&gt;/&lt;Latest-Entry&gt;/&lt;VM name&gt;.</li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>VM&#160;Snapshot retry attempts</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Set the number of times <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> should attempt to snapshot a virtual machine before canceling the job.</li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Use existing user</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Enable to select a previously entered username and password for the provider.</li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Guest OS&#160;Username/Password</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>For some  tasks (such as cataloging file metadata, file restore, and IP reconfiguration), credentials must be established for the associated virtual machine. Enter the username and password, and ensure the virtual machine can be accessed from the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> appliance either through DNS or host-name.</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>The default security policy uses the Windows NTLM protocol, and the user identity follows the default <b>domain\Name</b> format if the Hyper-V virtual machine is attached to a domain. The format   <b>&lt;local administrator&gt;</b> is used if the user is a local administrator.</li>
                                <li value="6">To troubleshoot a connection to a hypervisor virtual machine, use the Test function. The Test function verifies communication with the virtual machine and tests DNS settings between the <span class="ProductNames_LongShortECX_Short">IBM Spectrum Protect Plus</span> appliance and the virtual machine. To test a connection, select a single virtual machine, then click <b>Select Options</b>. Select <b>Use existing user</b> and select a previously entered username and password for the resource. A new Test button appears to the right of the Save button at the bottom of the Options section. Click <b>Test</b>. </li>
                                <li value="7">When you are satisfied that the job-specific information is correct, click <b>Save</b>. The job runs as defined by your SLA&#160;Policy, or can be run manually from the Job Monitor pane.</li>
                                <li value="8">To configure additional options, click the <b>Options</b> field associated with the job in the SLA&#160;Policy Status section. If no additional options are currently configured for the job, the field will display <i>Not Configured</i>. Set the additional job options.</li>
                                <li class="indent_strong" data-mc-autonum=""><span class="autonumber"><span></span></span>Pre-scripts and Post-Scripts</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>In the Pre-Script and/or Post-Script section, select an uploaded script and a script server where the script will run. Scripts and script servers are configured through the <b data-mc-conditions="Default.1012 navigation">Jobs and Monitoring &gt;&#160;Script</b> pane. See <a href="../../system/system_script.htm" class="MCXref xref" xrefformat="{paratext}">Configure Scripts</a>.</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Pre-scripts and post-scripts are scripts that can be run before or after a job runs at the job-level. Windows-based machines support Batch and PowerShell scripts while Linux-based machines support shell scripts. </li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span><b data-mc-conditions="Default.1012 navigation">Continue job/task on script error</b> - When enabled, if a Pre-script completes with a non-zero return code, the backup or restore is attempted and the Pre-script task status returns COMPLETED. When disabled, the backup or restore is not attempted, and the Pre-script task status returns FAILED.  If a Post-script completes with a non-zero return code, the Post-script task status returns COMPLETED. When disabled, the Post-script task status returns FAILED.</li>
                                <li class="indent" style="font-weight: bold;" data-mc-autonum=""><span class="autonumber"><span></span></span>Exclude Resources</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Exclude specific resources from the backup job  through single or multiple exclusion patterns. Resources can be excluded through an exact match or with wildcard asterisks specified before the pattern (*test) or after the pattern (test*). Multiple asterisk wildcards are also supported in a single pattern. Patterns support standard alphanumeric characters as well as the following special characters:&#160;- _ and *. Separate multiple filters with a semicolon. </li>
                                <li class="indent" style="font-weight: bold;" data-mc-autonum="" data-mc-conditions="Default.1012 navigation"><span class="autonumber"><span></span></span>Force Base Resources</li>
                                <li class="Indent_Level2" data-mc-autonum=""><span class="autonumber"><span></span></span>Force base backups for specific virtual machines or databases in the Backup job definition. All previous backup information associated with the resource will be removed. Separate multiple resources with a semicolon. </li>
                                <li value="9">Once complete, click <b>Save</b>.</li>
                            </ol>
                            <div class="RelatedTopic">
                                <p class="PostPreRelTitleLeft"><span class="PostPreRelTitle">RELATED TOPICS:</span>
                                </p>
                                <ul>
                                    <li value="1"><a href="hyperv_restore.htm" class="MCXref xref" xrefformat="{paratext}">Create a Hyper-V Restore Job Definition</a>
                                    </li>
                                    <li value="2"><a href="hyperv_manage.htm" class="MCXref xref" xrefformat="{paratext}">Add a Hyper-V Provider</a>
                                    </li>
                                </ul>
                            </div>
                            <p>&#160;</p>
                            <hr width="100%" size="0" align="center" />
                            <p style="text-align: left;"><span class="Strong" style="font-size: 10pt;">IBM Spectrum Protect Plus</span> <span class="Strong" style="font-size: 10pt;">10.1.2</span> <![CDATA[ ]]></p>
                            <p style="font-size: 8pt;">Licensed Material - Property of IBM Corp. © IBM Corporation and other(s) <span class="GeneralYear">2018</span>. IBM is a registered trademark of the IBM Corporation in the United States, other countries, or both. <span style="font-size: 10pt;"><span style="font-size: 8pt;">| </span></span><span style="font-size: 8pt;" class="SystemShortDate">8/23/2018</span></p>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>